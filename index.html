<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Bilancio Personale Multitab</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; background: #f7f7f7;}
    h1 { text-align: center; }
    nav { margin: 20px 0; }
    nav button { padding:10px 25px;margin-right:5px;font-size:1.1em;border:none;border-radius:6px;cursor:pointer;}
    .active { background: #339cff; color: #fff; }
    section { display:none; padding:16px; background:#fff; border-radius:8px; box-shadow:1px 2px 8px #bbb;}
    section.active { display:block; }
    table { width:100%; margin-top:10px; border-collapse:collapse; }
    th, td { border:1px solid #ddd; padding:4px; }
    th { background:#eee; }
    label { margin-top: 8px; font-weight: bold; display:block; }
    select, input, button { width: 100%; padding: 10px; margin: 8px 0; }
  </style>
</head>
<body>
  <h1>Bilancio Personale</h1>
  <nav>
    <button id="btnInput" class="active">Input</button>
    <button id="btnDettaglio">Dettaglio Spese</button>
    <button id="btnBudget">Budget</button>
    <button id="btnCategorie">Categorie</button>
  </nav>

  <!-- Input movimento -->
  <section id="tabInput" class="active">
    <h2>Nuovo Movimento</h2>
    <form id="movForm">
      <label>Tipo</label>
      <select id="tipo" required>
        <option value="Uscita" selected>Uscita</option>
        <option value="Entrata">Entrata</option>
      </select>
      <label>Data</label>
      <input type="date" id="data" required>
      <label>Importo (€)</label>
      <input type="number" id="euro" min="0" step="0.01" required>
      <label>Descrizione</label>
      <input type="text" id="descrizione" required>
      <label>Categoria</label>
      <select id="categoria" required></select>
      <button type="submit">Aggiungi</button>
    </form>
  </section>

  <!-- Dettaglio spese -->
  <section id="tabDettaglio">
    <h2>Dettaglio Spese</h2>
    <table id="dettaglioTable">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Data</th>
          <th>Mese</th>
          <th>Anno</th>
          <th>Euro</th>
          <th>Descrizione</th>
          <th>Categoria</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Budget -->
  <section id="tabBudget">
    <h2>Budget</h2>
    <div id="budgetStats"></div>
  </section>

  <!-- Categorie -->
  <section id="tabCategorie">
    <h2>Categorie</h2>
    <table>
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Categoria</th>
          <th>Descrizione</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>NECESSITÀ</td><td>TRASPORTI</td><td>treno, bus, autostrada, parcheggi</td></tr>
        <tr><td>NECESSITÀ</td><td>AFFITTO</td><td>affitto</td></tr>
        <tr><td>NECESSITÀ</td><td>UTENZE</td><td>acqua, energia, gas, internet, telefono</td></tr>
        <tr><td>NECESSITÀ</td><td>SPESA E ALIMENTARI</td><td>spesa per cibo</td></tr>
        <tr><td>NECESSITÀ</td><td>CURA PERSONALE</td><td>shampoo, rasoio, parrucchiere, dentista, fisioterapista</td></tr>
        <tr><td>NECESSITÀ</td><td>SPESE MEDICHE</td><td>visite mediche e farmaci</td></tr>
        <tr><td>NECESSITÀ</td><td>VESTITI ESSENZIALI</td><td>vestiti</td></tr>
        <tr><td>NECESSITÀ</td><td>COSE DELLA CASA</td><td>mobili, elettronica, accessori casa, cucina</td></tr>
        <tr><td>NECESSITÀ</td><td>SPESE SCOLASTICHE</td><td></td></tr>
        <tr><td>EXTRA</td><td>RISTORANTE</td><td>mangiare fuori</td></tr>
        <tr><td>EXTRA</td><td>VACANZA</td><td>vacanze, gite</td></tr>
        <tr><td>EXTRA</td><td>REGALI</td><td>regali</td></tr>
        <tr><td>EXTRA</td><td>ALTRO EXTRA</td><td></td></tr>
        <tr><td>EXTRA</td><td>USCITE</td><td></td></tr>
        <tr><td>EXTRA</td><td>SIGARETTE</td><td></td></tr>
        <tr><td>ENTRATE</td><td>Lavoro</td><td></td></tr>
        <tr><td>ENTRATE</td><td>Mamma</td><td></td></tr>
        <tr><td>ENTRATE</td><td>Nonna</td><td></td></tr>
        <tr><td>ENTRATE</td><td>Roxana</td><td></td></tr>
        <tr><td>ENTRATE</td><td>Entrate extra</td><td></td></tr>
        <tr><td>ENTRATE</td><td>Rimborsi</td><td></td></tr>
      </tbody>
    </table>
  </section>

<script>
// Categorie
const categories = {
  Uscita: [
    "TRASPORTI",
    "AFFITTO",
    "UTENZE",
    "SPESA E ALIMENTARI",
    "CURA PERSONALE",
    "SPESE MEDICHE",
    "VESTITI ESSENZIALI",
    "COSE DELLA CASA",
    "SPESE SCOLASTICHE",
    "RISTORANTE",
    "VACANZA",
    "REGALI",
    "ALTRO EXTRA",
    "USCITE",
    "SIGARETTE"
  ],
  Entrata: [
    "Lavoro",
    "Mamma",
    "Nonna",
    "Roxana",
    "Entrate extra",
    "Rimborsi"
  ]
};

// Navigazione tab
function showTab(tab) {
  document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
  document.getElementById('btn' + tab).classList.add('active');
  document.getElementById('tab' + tab).classList.add('active');
}
document.getElementById('btnInput').onclick = () => showTab('Input');
document.getElementById('btnDettaglio').onclick = () => { showTab('Dettaglio'); loadDettaglio(); }
document.getElementById('btnBudget').onclick = () => { showTab('Budget'); calcBudget(); }
document.getElementById('btnCategorie').onclick = () => showTab('Categorie');

// Imposta le categorie su base tipo Entrata/Uscita
function setCategoryOptions(tipo) {
  let select = document.getElementById('categoria');
  select.innerHTML = '<option value="">Seleziona categoria</option>';
  categories[tipo].forEach(c => {
    let opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    select.appendChild(opt);
  });
}

// Aggiorna il menu categorie quando cambia tipo
document.getElementById('tipo').addEventListener('change', function() {
  setCategoryOptions(this.value);
});

// All’avvio, preseleziona “Uscita” e mostra le categorie corrette
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('data').value = new Date().toISOString().split('T')[0];
  setCategoryOptions('Uscita');
  loadDettaglio();
  calcBudget();
});

// Salva nuovo movimento su localStorage
document.getElementById('movForm').onsubmit = function(e) {
  e.preventDefault();
  let tipo = document.getElementById('tipo').value;
  let data = document.getElementById('data').value;
  let euro = parseFloat(document.getElementById('euro').value);
  let descrizione = document.getElementById('descrizione').value;
  let categoria = document.getElementById('categoria').value;
  let dt = new Date(data);
  let mese = dt.toLocaleString('it-IT', { month: 'long' });
  let anno = dt.getFullYear();
  let movimenti = JSON.parse(localStorage.getItem('movimenti') || "[]");
  movimenti.push({tipo, data, mese, anno, euro, descrizione, categoria});
  localStorage.setItem('movimenti', JSON.stringify(movimenti));
  this.reset();
  document.getElementById('tipo').value = "Uscita";
  setCategoryOptions('Uscita');
  document.getElementById('data').value = new Date().toISOString().split('T')[0];
  alert("Movimento inserito!");
  loadDettaglio();
  calcBudget();
}

// Dettaglio spese
function loadDettaglio() {
  let tbody = document.querySelector('#dettaglioTable tbody');
  tbody.innerHTML = '';
  let movimenti = JSON.parse(localStorage.getItem('movimenti') || "[]");
  movimenti.forEach(m => {
    let row = `<tr>
      <td>${m.tipo}</td>
      <td>${m.data}</td>
      <td>${m.mese}</td>
      <td>${m.anno}</td>
      <td>€ ${m.euro.toFixed(2)}</td>
      <td>${m.descrizione}</td>
      <td>${m.categoria}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

// Budget tab: riepilogo base
function calcBudget() {
  let movimenti = JSON.parse(localStorage.getItem('movimenti') || "[]");
  let entrateTot = movimenti.filter(m => m.tipo === "Entrata")
    .reduce((tot, m) => tot + m.euro, 0);
  let usciteTot = movimenti.filter(m => m.tipo === "Uscita")
    .reduce((tot, m) => tot + m.euro, 0);
  let balance = entrateTot - usciteTot;
  document.getElementById('budgetStats').innerHTML = `
    <strong>Totale entrate:</strong> €${entrateTot.toFixed(2)}<br>
    <strong>Totale uscite:</strong> €${usciteTot.toFixed(2)}<br>
    <strong>Saldo attuale:</strong> €${balance.toFixed(2)}
  `;
}
</script>
</body>
</html>
